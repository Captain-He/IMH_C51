#ifndef _HCSR04_    //?????????????????????
#define _HCSR04_


#include<reg52.h>

#define uchar unsigned char     //??????????????har???
#define uint  unsigned int      //??????????????nt???
#define ulong unsigned long     //??????????????ong???
sbit play  = P1^4;    //ISD1820????????IO??
sbit RX=P0^1;       //Echo???
sbit TX=P0^0;       //Trig???

sbit RX_1=P3^4;
sbit TX_1=P3^5;

uint flag1 = 0,flag1_1 = 0;
uint  time=0,time_1=0;
uint  timer=0,timer_1=0;
ulong S=0,S_1=0;
bit   flag =0, flag_1 =0;
uint hcsr=0;

/*
void delay(uint z)    //?????????,z???
{
    uint x, y;
    for(x = z; x > 0; x--)
    for(y = 112; y > 0; y--);
}
*/

void Display()
{
    if(S>100)
    {
        //led=0;
		play = 1;
        led_off();
        flag1 = 1;
    }
    else
    {
			play = 1;
			play = 0;
       // led=1;
    }
     
}
/*********************************/
void Display_1()
{
    if(S_1>100)
    {
        //led=0;
		play = 1;
        led_off1();
        flag1_1 = 1;
    }
    else
    {
			play = 1;
			play = 0;
       // led=1;
    }
     
}



/*******************************/
void Conut(void)
{
    time=TH0*256+TL0;
    TH0=0;
    TL0=0;

    S= (long)(time*0.17);     //??????CM
    if((S>=4000)||flag==1) //??????????????RR0??
        flag=0;

}

void Conut_1(void)
{
    time_1=TH0*256+TL0;
    TH0=0;
    TL0=0;

    S_1= (long)(time_1*0.17);     //??????CM
    if((S_1>=4000)||flag_1==1) //??????????????RR0??
        flag_1=0;

}


void zd0() interrupt 1          //T0???????????????????????
{
    flag=1;     //?????????
	flag_1=1;
}

void  zd3()  interrupt 3    //T1?????????????????00MS??????
{
    TH1=0xf8;
    TL1=0x30;
	if(hcsr==1)
	{
		Display();
   		timer++;
    	if(timer>=100)
    	{
	        timer=0;
	        TX=1;			                //800MS  ????€??a??
	        delay(50);
	        TX=0;
   	 	} 	
	}
	else if(hcsr==2)
	 {
	   Display_1();
   		timer_1++;
    	if(timer_1>=100)
    	{
	        timer_1=0;
	        TX_1=1;			                //800MS  ????€??a??
	        delay(50);
	        TX_1=0;
   	 	} 	
	 }
    	  
}

void  distance()
{  
    TMOD=0x11;		   //??0???????ATE=1??
    TH0=0;
    TL0=0;          
    TH1=0xf8;		   //2MS???
    TL1=0x30;
    ET0=1;             //???T0???
    ET1=1;			   //???T1???
    TR1=1;			   //?€??????
    EA=1;			   //?€??€????

    while(!flag1)
    {
        while(!RX);		//??X????????
        TR0=1;			    //?€?????
        while(RX);			//??X??????????
        TR0=0;				//??????
        Conut();			//?$?
    }

}

void  distance_1()
{  
    TMOD=0x11;		   //??0???????ATE=1??
    TH0=0;
    TL0=0;          
    TH1=0xf8;		   //2MS???
    TL1=0x30;
    ET0=1;             //???T0???
    ET1=1;			   //???T1???
    TR1=1;			   //?€??????
    EA=1;			   //?€??€????

    while(!flag1_1)
    {
        while(!RX_1);		//??X????????
        TR0=1;			    //?€?????
        while(RX_1);			//??X??????????
        TR0=0;				//??????
        Conut_1();			//?$?
    }

}
#endif